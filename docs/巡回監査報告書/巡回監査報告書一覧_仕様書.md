---
title: 巡回監査報告書 一覧 仕様書
---

# 巡回監査報告書（一覧） 仕様書

**画面ID**: `patrol-audit-list`

**目的（概要）**: 登録済みの巡回監査報告書を一覧表示し、作成・編集・削除などの操作を行う。編集は作成画面を再利用し、行に紐づく顧問先情報を優先表示する。

**主なユーザー**: 監査担当、事務担当

---

## 1. 想定ユースケース
- 一覧で報告書のサマリを確認する。
- 行単位で編集または削除を行う（編集は作成画面を再利用）。
- 新規作成は顧問先を選択して作成画面へ遷移。

---

## 2. 画面構成（ワイヤー）
- ヘッダー: タイトル「巡回監査報告書」、右上に `作成` ボタン。
- メイン: テーブル形式で一覧表示（コンポーネント: `List`）
  - カラム: `巡回日` / `顧問先` / `担当者` / `ステータス` / `操作`
  - 各行の操作: 編集（鉛筆アイコン） / 削除（ゴミ箱アイコン）

---

## 3. 詳細仕様（要素ごと）
- **テーブル**: `frontend/src/common/dashboard/List.tsx` を利用。行クリックで選択、操作列内のボタンで編集/削除。
- **新規作成ボタン**: 顧問先未選択時はダイアログで選択を促す。

### テーブルのカラム定義
- `date` (巡回日): 表示用文字列（例: 2025-11-17）
- `clientName` (顧問先): 顧問先名（編集時は行の顧問先名を優先表示）
- `auditor` (担当者): 文字列
- `status` (ステータス): `下書き` / `提出済み` 等
- `actions` (操作): 編集 / 削除

---

## 4. インタラクション / 状態遷移
- 初期表示: ローカルモックまたは `GET /patrol_audits` をフェッチして表示。
- 編集: 編集ボタンで作成画面へ遷移（`initialValues` を用いてプレフィル）。顧問先が未登録の場合は `currentClientName` を設定して表示。
- 削除: 確認ダイアログ後にローカル配列から削除または `DELETE /patrol_audits/:id` を呼ぶ。

---

## 5. データモデル（画面で使用する型）
```ts
export type PatrolAudit = {
  id: string;
  date: string; // YYYY-MM-DD
  clientId?: string;
  clientName: string;
  auditor?: string;
  status?: string;
}
```

---

## 6. API（想定）
- `GET /patrol_audits` → `200 [{ id,date,clientName,auditor,status }, ...]`
- `GET /patrol_audits/:id` → `200 { ...details }`
- `POST /patrol_audits` → `201 { id }`
- `PUT /patrol_audits/:id` → `200 { id, updatedAt }`
- `DELETE /patrol_audits/:id` → `204`

---

## 7. バリデーション / エラー表示
- 削除は確認ダイアログを表示。
- 一覧取得失敗時はエラーメッセージと再試行ボタンを表示。

---

## 8. 権限
- 編集/削除はロールベースで制御（実装時に backend のロールを参照）。

---

## 9. テスト/受け入れ基準
- 一覧が表示されること。
- 編集ボタンで作成画面が開き、プレフィルされること。
- 削除が確認の上で実行できること。

---

**関連実装ファイル**:
- `frontend/src/features/patrol-audit/components/PatrolAuditListPage.tsx`
- `frontend/src/features/patrol-audit/PatrolAuditPage.tsx`
# 巡回監査報告書一覧 画面仕様書

## 基本情報
- 画面ID: patrol-audit-list
- 画面名: 巡回監査報告書（一覧）
- 目的（概要）: 登録済みの巡回監査報告書を一覧表示し、作成・編集・削除・チャットへの連携（削除済）などの操作を行う。
- 主なユーザー: 担当職員、担当監査員
- 優先度: 中
- ステータス: 実装中（ローカルモック対応）
- 関連画面: `/patrol-audit/create`（作成/編集画面、実装上はモーダルまたはページ遷移）

## 想定ユースケース
- ユーザーが巡回監査メニューから一覧画面へ遷移し、報告書を確認する。
- 一覧から新規作成ボタンで作成モーダルを開く。
- 一覧の行で「編集」を選択すると、該当報告書を編集するために作成画面を開く（顧問先選択不要：行の顧問先をそのまま表示）。
- 一覧の行で「削除」を押すとローカル一覧から削除（今後は API 呼び出しで永続化）。

## 画面構成
- ヘッダー: タイトル「巡回監査報告書」、右上に作成ボタン。
- メイン領域: テーブル（List コンポーネントを利用）
  - カラム: 巡回日 / 顧問先 / 担当者 / ステータス / 操作
  - 各行の操作: 編集（アイコン）、削除（アイコン）
- モーダル: 新規作成用の `DashboardModal`（顧問先選択 → 作成へ）

## 詳細仕様（テーブル）
- テーブルは `frontend/src/common/dashboard/List.tsx` を利用。
- カラム定義:
  - `date` (巡回日): 表示用文字列
  - `clientName` (顧問先): 顧問先名
  - `auditor` (担当者): 文字列
  - `status` (ステータス): 文字列（下書き／提出済み など）
  - `actions` (操作): 編集／削除ボタン（編集は作成画面へ遷移）

## 入力要素（一覧画面）
- 新規作成モーダル内の `Select`（顧問先選択）: `searchable`, `clearable` を使用。
- 新規開始ボタンは `作成開始`。顧問先未選択時は無効。

## インタラクション / 状態遷移
- 初期表示: `dummyAudits`（現行はローカル配列）を表示。将来は API `GET /patrol_audits` をフェッチ。
- 作成モーダルを開いて顧問先を選択 → 作成開始で作成画面へ遷移（モーダルは閉じる）。
- 編集ボタンを押すと:
  - 顧問先が client 一覧に存在する場合は `selectClient(id)` を呼び、作成画面へ遷移（編集モード）。
  - 顧問先が存在しない場合でも `selectClientName(name)` を呼び、ヘッダーに顧問先名を表示して作成画面へ遷移する（顧問先選択は不要）。
- 削除ボタンを押すとローカル一覧から削除。将来は `DELETE /patrol_audits/:id` を呼び UI を更新。

## データモデル（画面で使用する型）
- PatrolAudit (一覧行)
```ts
export type PatrolAudit = {
  id: number;
  date: string; // YYYY-MM-DD
  clientName: string;
  auditor: string;
  status: string;
}
```

## API仕様（想定）
- GET `/patrol_audits`
  - Response: `200 [{ id, date, clientName, auditor, status }, ...]`
- GET `/patrol_audits/:id`
  - Response: `200 { id, date, clientName, auditor, status, ...details }`
- POST `/patrol_audits`
  - Request: 新しい報告書データ
  - Response: `201 { id, ... }`
- PUT `/patrol_audits/:id`
  - Request: 更新データ
  - Response: `200 { id, ... }`
- DELETE `/patrol_audits/:id`
  - Response: `204`

## バリデーション / エラーメッセージ
- 削除時の確認ダイアログ（推奨）：「本当に削除しますか？」
- 新規作成モーダル: 顧問先が未選択の場合 `作成開始` は disabled

## 権限・認可
- 編集/削除は、担当権限を持つユーザーのみ（実装時にロールベースのチェックが必要）。

## テスト/受け入れ基準
- 正常系: 一覧が表示され、新規モーダルが開き、作成開始で作成画面に遷移する。
- 異常系: 顧問先一覧が空のとき `nothingFoundMessage` が表示される。

## 実装メモ / 注意点
- コンポーネント
  - `frontend/src/features/patrol-audit/components/PatrolAuditListPage.tsx`
  - `frontend/src/features/patrol-audit/PatrolAuditPage.tsx`
- 削除操作は現在ローカル state でのみ行われる。永続化 API の追加が必要。

---

